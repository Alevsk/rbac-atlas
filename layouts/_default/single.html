{{ define "main" }}
<article class="post">
  <div class="title-version-wrapper">
    <div class="title-section">
      <h1 class="post-title">
        <a href="{{ .Permalink }}">{{ .Title | markdownify }}</a>
      </h1>
      {{ $currentPath := .File.Dir }}
      {{ $projectName := index (split .File.Dir "/") 1 }}
      {{ $projectPages := where .Site.RegularPages "File.Dir" (printf "charts/%s/" $projectName) }}
      {{ $sortedVersions := sort $projectPages "Params.version_order" "desc" }}
      {{ if gt (len $sortedVersions) 1 }}
      <div class="version-selector">
        <select class="version-select" onchange="window.location.href=this.value">
          {{ range $sortedVersions }}
          <option value="{{ .Permalink }}"
                  {{ if eq .Params.version $.Params.version }}
                  selected
                  {{ end }}>
            {{ .Params.version }}
          </option>
          {{ end }}
        </select>
      </div>
    {{ else }}
      <div class="version-subtitle">{{ .Params.version }}</div>
      {{ end }}
    </div>
  </div>

  <div class="post-stats">
    <div class="stat-item">
      <i class="fas fa-user"></i>
      {{ .Params.service_accounts }} Service Accounts
    </div>
    <div class="stat-item">
      <i class="fas fa-cube"></i>
      {{ .Params.workloads }} Workloads
    </div>
    <div class="stat-item">
      <i class="fas fa-link"></i>
      {{ .Params.bindings }} Bindings
    </div>
    {{ if gt (int .Params.critical_findings) 0 }}
    <div class="stat-item risk-critical">
      <i class="fas fa-skull"></i>
      {{ .Params.critical_findings }} Critical
    </div>
    {{ end }}
    {{ if gt (int .Params.high_findings) 0 }}
    <div class="stat-item risk-high">
      <i class="fas fa-exclamation-triangle"></i>
      {{ .Params.high_findings }} High
    </div>
    {{ end }}
    {{ if gt (int .Params.medium_findings) 0 }}
    <div class="stat-item risk-medium">
      <i class="fas fa-exclamation-circle"></i>
      {{ .Params.medium_findings }} Medium
    </div>
    {{ end }}
    {{ if gt (int .Params.low_findings) 0 }}
    <div class="stat-item risk-low">
      <i class="fas fa-info-circle"></i>
      {{ .Params.low_findings }} Low
    </div>
    {{ end }}
  </div>
  <div class="post-meta">
    {{- if .Date -}}
    <time class="post-date">
      {{- partial "post-date" . -}}
      {{- if and $.Site.Params.showLastUpdated .Lastmod -}}
      &nbsp;{{- partial "post-lastmod" . -}}
      {{- end -}}
    </time>
    {{- end -}}
    {{- with .Params.Author -}}
    <span class="post-author">{{ . }}</span>
    {{- end -}}
    {{- if and (.Param "readingTime") (eq (.Param "readingTime") true) -}}
    <span class="post-reading-time">{{ .ReadingTime }} {{ $.Site.Params.minuteReadingTime | default "min read" }} ({{ .WordCount }} {{ $.Site.Params.words | default "words" }})</span>
    {{- end -}}
  </div>

  {{ if .Params.tags }}
  <div class="tags-list">
    <p>
      {{ $tags := .Params.tags }}
      {{ $tagCount := len $tags }}
      <span class="initial-tags">
        {{ range first 10 $tags }}
        <a href="{{ (urlize (printf "tags/%s/" .)) | absLangURL }}">{{ . }}</a>
        {{ end }}
      </span>
      {{ if gt $tagCount 10 }}
      <span class="extra-tags" style="display: none;">
        {{ range after 10 $tags }}
        <a href="{{ (urlize (printf "tags/%s/" .)) | absLangURL }}">{{ . }}</a>
        {{ end }}
      </span>
      <button class="toggle-tags"
              onclick="toggleTags(this)"
              data-count="{{ sub $tagCount 10 }}">(+{{ sub $tagCount 10 }} more)</button>
      {{ end }}
    </p>
  </div>


  {{ end }}
  {{ partial "cover.html" . }}

  {{ if (.Params.Toc | default .Site.Params.Toc) }}
  <div class="table-of-contents">
    <h2>{{ (.Params.TocTitle | default .Site.Params.TocTitle) | default "Table of Contents" }}</h2>
    {{ .TableOfContents }}
  </div>
  {{ end }}

  <div class="post-content">{{ .Content }}</div>

</article>
{{ end }}
